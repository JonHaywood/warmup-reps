
<!DOCTYPE html> 
<html> 

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>Warmup Calculator</title> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.js"></script>

	<script type="text/javascript">

		var warmupApp = {
			"metric" : false,
			barWeight : function() {
				return warmupApp.metric ? 20 : 45;
			},
			weights : function() {
				if (warmupApp.metric)
					return [20, 15, 10, 5, 2.5, 1.25];
				else
					return [45, 35, 25, 10, 5, 2.5];
			},
			"programs" : []
		}

		$(document).ready(function() {
			$.ajax({
				url: 'programs/starting_strength.json',
				dataType: 'json',
				success: function(data) {
			    warmupApp.programs.push(data);
				},
				async: false
			});

			$('#units').change(function() {
				warmupApp.metric = !warmupApp.metric;

				$('input').attr('min', warmupApp.barWeight().toString());

				//trigger update for all lists, currently shows lbs until slider is changed
			});

			for (i = 0; i < warmupApp.programs.length; i++) {
				var shortTitle = warmupApp.programs[i].title.toLowerCase().replace(/ /g, '-');

				// generate homepage links
				$('#programs').append('<p><a href="#' + shortTitle + 
					'" data-role="button" id="' + shortTitle + 
					'-link">' + warmupApp.programs[i].title + '</a></p>');

				//generate page for program
				$('body').append('<div data-role="page" id="' + shortTitle + '"> \
						<div data-role="header"><h1>Warmup Calculator</h1></div> \
						<div data-role="content"> \
							<h2>' + warmupApp.programs[i].title + '</h2> \
							<p>Getting started is easy.  Choose a program, exercise, and then set your target weight.  Your warmup sets will then be automatically calculated.</p> \
							<h3>Choose an exercise:</h3><div id="' + shortTitle + '-exercises"></div> \
							<hr /><p><a href="#main" data-direction="reverse" data-role="button">Choose another program</a></p></div> \
						<div data-role="footer" data-theme="d"><h4>&copy; 2012 Nicholas Munson</h4></div> \
					</div>');

				//add exercises
				for (j = 0; j < warmupApp.programs[i].exercises.length; j++) {
					shortExerciseName = warmupApp.programs[i].exercises[j].name.toLowerCase().replace(/ /g, '-');
					$('#' + shortTitle + '-exercises').append(
						'<p><a href="#' + shortTitle + "-" + shortExerciseName + '" data-role="button" id="' + 
						shortExerciseName + '-link">' + warmupApp.programs[i].exercises[j].name + '</a></p>');

					//generate page for each exercise
					$('body').append('<div data-role="page" id="' + shortTitle + "-" + shortExerciseName + '"> \
						<div data-role="header"><h1>Warmup Calculator</h1></div> \
						<div data-role="content"><h2>' + warmupApp.programs[i].exercises[j].name + '</h2> \
						<p>Choose your working weight.  Your warmup sets will then be calculated as well as the weights you need to put on each bar side.</p>	\
				   		<div id="' + shortTitle + "-" + shortExerciseName + '-weight-container"><label for="' + shortTitle + "-" + shortExerciseName + '-weight">Weight:</label> \
				   		<input type="range" name="' + shortTitle + "-" + shortExerciseName + '-weight" id="' + shortTitle + "-" + shortExerciseName + '-weight" value="100" min="45" max="350" step="5" />	\
						</div><ul data-role="listview" data-inset="true" id="' + shortTitle + "-" + shortExerciseName + '-warmup"></ul> \
						<p><a href="#' + shortTitle + '" data-direction="reverse" data-role="button">Choose another exercise</a></p>	\
						</div><div data-role="footer" data-theme="d"><h4>&copy; 2012 Nicholas Munson</h4></div></div>');

					$('#' + shortTitle + "-" + shortExerciseName + '-warmup')
						.data('workouts', warmupApp.programs[i].exercises[j].workouts);

					//add each set
					for (k = 0; k < warmupApp.programs[i].exercises[j].workouts.length; k++) {
						var workout = warmupApp.programs[i].exercises[j].workouts[k];
						var setWeight = findWeight(workout, $('#' + shortTitle + '-' + shortExerciseName + '-weight').val());

						$('#' + shortTitle + "-" + shortExerciseName + '-warmup').append('<li>' + 
							printSet(workout.sets, workout.reps, setWeight) + 
							' (' + calculateBarbellWeights(setWeight) + ')</li>');
					}

				}

				$('div').filter(function() {
					return this.id.match(/-weight-container/);
				})
				.change(function() {
					updateWorkout($(this).next(), $(this).find('input').val());
				});
			
			}

			$('#main').page("destroy").page();

		});

		function updateWorkout(list, weight) {
			var workouts = [];

			for (i = 0; i < list.data('workouts').length; i++) {
				workouts.push(list.data('workouts')[i]);
			}

			list.empty();

			for (i = 0; i < workouts.length; i++) {
				var workout = workouts[i];
				var setWeight = findWeight(workout, weight);

				list.append('<li>' + 
					printSet(workout.sets, workout.reps, setWeight) + 
					' (' + calculateBarbellWeights(setWeight) + ')</li>');
			}

			list.listview('refresh');
		}

		function calculateBarbellWeights(weight) {
			weight -= warmupApp.barWeight();

			if (weight === 0)
				return "Bar";

			weight /= 2;

			var weight_45 = 0;
			var weight_35 = 0;
			var weight_25 = 0;
			var weight_10 = 0;
			var weight_5 = 0;
			var weight_2half = 0;

			while (weight > 0) {
				if (weight >= warmupApp.weights()[0]) {
					weight_45 += 1;
					weight -= warmupApp.weights()[0];
					continue;
				}
				else if (weight >= warmupApp.weights()[1]) {
					weight_35 += 1;
					weight -= warmupApp.weights()[1];
					continue;					
				}
				else if (weight >= warmupApp.weights()[2]) {
					weight_25 += 1;
					weight -= warmupApp.weights()[2];
					continue;					
				}
				else if (weight >= warmupApp.weights()[3]) {
					weight_10 += 1;
					weight -= warmupApp.weights()[3];
					continue;					
				}
				else if (weight >= warmupApp.weights()[4]) {
					weight_5 += 1;
					weight -= warmupApp.weights()[4];
					continue;					
				}
				else {
					weight_2half += 1;
					weight -= warmupApp.weights()[5];
					continue;					
				}				
			}

			var result = "";

			if (weight_45 != 0) 
				result += printWeightCountSubstring(weight_45, warmupApp.weights()[0].toString());
			if (weight_35 != 0)
				result += printWeightCountSubstring(weight_35, warmupApp.weights()[1].toString());
			if (weight_25 != 0)
				result += printWeightCountSubstring(weight_25, warmupApp.weights()[2].toString());
			if (weight_10 != 0)
				result += printWeightCountSubstring(weight_10, warmupApp.weights()[3].toString());
			if (weight_5 != 0) 
				result += printWeightCountSubstring(weight_5, warmupApp.weights()[4].toString());
			if (weight_2half != 0)
				result += printWeightCountSubstring(weight_2half, warmupApp.weights()[5].toString());

			return $.trim(result);
		}

		function printWeightCountSubstring(weight, text) {
			if (weight > 1)
				return weight + "x" + text + " ";
			else
				return text + " ";
		}

		function findWeight(exercise, weight) {
			if (exercise.multiplier != undefined)
				return roundDown(exercise.multiplier * weight);
			else
				return exercise.weight;
		}
		
		function printSet(sets, reps, weight) {
			var output = sets + "x" + reps + " " + weight;
			if (warmupApp.metric)
				return output + " kgs"
			else 
				return output + " lbs"
		}

		function roundDown(num) {
			if (num - (num % 5) < warmupApp.barWeight())
				return warmupApp.barWeight();
			else
				return num - (num % 5);
		}		

	</script>
</head> 

	
<body> 


<div data-role="page" id="main">

	<div data-role="header">
		<h1>Warmup Calculator</h1>
	</div>

	<div data-role="content" >	
		<h2>Getting Started</h2>

		<p>Getting started is easy.  Choose a program, exercise, and then set your target weight.  Your warmup sets will then be automatically
		calculated.</p>	

		<h3>Choose a program:</h3>
		<div id="programs">
		</div>

		<hr />
		<h4>Settings</h4>

		<label for="units">Unit system:</label>
		<select name="slider" id="units" data-role="slider">
			<option value="lbs">Pounds</option>
			<option value="kgs">Kilograms</option>
		</select>		

	</div>

	<div data-role="footer" data-theme="d">
		<h4>&copy; 2012 Nicholas Munson</h4>
	</div>
</div>

</body>
</html>
